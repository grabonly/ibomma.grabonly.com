---
import { filterCrew, findCountry, findLang, formatDate, joinGenres, movieCredits, productionCompanies, supportRoles } from "../API/helpers";
import { movieFAQs } from "../data/movie-faqs.json";
import FAQ from "./FAQ.astro";
import Genres from '../API/helpers.astro'
import PostUpdateTime from "./PostUpdateTime.astro";
import { movieAssets } from "../API/movieAssets";

const {movie, movie_id} = Astro.props;
const credit = await movieCredits(movie_id);
const movieGenres = joinGenres(movie.genres);
const p_companies = productionCompanies(movie.production_companies);
const [hero, heroine] = credit.cast.filter(member => member.order == 0 || 1);
const supportChars = supportRoles(credit.cast);

const crew = credit.crew;
const directorNames = filterCrew(crew, "Director");
const writerNames = filterCrew(crew, "Lyricist");
const producerNames = filterCrew(crew, "Producer");
const editorNames = filterCrew(crew, "Editor");
const composerNames = filterCrew(crew, "Original Music Composer");
const cinematographerNames = filterCrew(crew, "Director of Photography")
const screenplayNames = filterCrew(crew, "Screenplay");

const imgURL = "/images/w300";
const [images, videos] = await movieAssets(movie_id);
---

<article>
    <h1>{movie.title} Movie Review </h1>
    <PostUpdateTime/>

    <p>{movie.title} is an exciting {movieGenres} movie, directed by {directorNames}. And it is written by the {writerNames} and also produced by {producerNames}. This movie was released on date {formatDate(movie.release_date)} and it also promises that to be an exciting experience for those who loves genres including but not limited to {movieGenres} ...Genres.</p>
    
    <h2>Complete Details of {movie.title}</h2>
    <div class="d-flex align-items-center justify-content-center">
    {
      images.posters.map((img, index)=>{
        ++index;
        if(index>2){
          return;
        }
        return <img class="col-6 mb-2" src={imgURL+img.file_path} height="300"/>
      })
    }
    </div>

    <table class="table table-striped table-hover border">
        <tbody>
            <tr>
              <td class="w-50">Movie Name</td>
              <td><a class="text-decoration-none" href="./">{movie.title}</a></td>
            </tr>
            <tr>
              <td>Original Language</td>
              <td>{findLang(movie.original_language)}</td>
            </tr>
            {/* <tr>
              <td>Spoken Language</td>
              <td>[Spoken Language]</td>
            </tr> */}
            <tr>
              <td>Release Date</td>
              <td>{formatDate(movie.release_date)}</td>
            </tr>
            <tr>
              <td>Runtime</td>
              <td>{movie.runtime} min</td>
            </tr>
            <tr>
              <td>Country</td>
              <td>{findCountry(movie.origin_country)}</td>
            </tr>
            <tr>
              <td>Genres</td>
              <td><Genres genres={movie.genres}/></td>
            </tr>
            <tr>
              <td>Writer</td>
              <td>{writerNames}</td>
            </tr>
            <tr>
              <td>Director</td>
              <td>{directorNames}</td>
            </tr>
            <tr>
              <td>Producers</td>
              <td>{producerNames}</td>
            </tr>
            <tr>
              <td>Editors</td>
              <td>{editorNames}</td>
            </tr>
            <tr>
              <td>Music</td>
              <td>{composerNames}</td>
            </tr>
            <tr>
              <td>Cinematography</td>
              <td>{cinematographerNames}</td>
            </tr>
            <tr>
              <td>Screenplay</td>
              <td>{screenplayNames}</td>
            </tr>
            <tr>
              <td>Production Companies</td>
              <td>{p_companies}</td>
            </tr>
          </tbody>
    </table>

    <h2>{movie.title} Summury</h2>
    <p>{movie.overview}</p>

    <h2>Basic Overview</h2>
    <p>Directed by {directorNames}, {movie.title} is a visually beautiful movie. The camera work, done by {cinematographerNames}, his work is really impressive and also makes the action scenes even more interesting and exciting. The music is composed by {composerNames}, which aligns perfectly with the story of the movie & also makes the feel on the movie was even more intensive.</p>

    <h2>Expectations</h2>
    <p>With the runtime of {movie.runtime} mins, {movie.title} will take you on a thrilling ride. This movie has lots of action scenes, emotional moments, and the things that you even won’t expect. If you like the genres like {movieGenres} ..genres, you will really enjoy this movie. It has a great mix of [{movieGenres} etc.], which will keep you connected during the movie show time.</p>

    {images.backdrops.length>0?<h2>{movie.title} Screenshots</h2>: ""}
      <div class="text-center">
        {
          images.backdrops.map((img,index) => {
            ++index;
            if(index>5){
              return;
            }
            return <img class="w-100 m-1" src={imgURL+img.file_path} alt={movie.title+"screenshot "+index} title={movie.title+"screenshot "+index}/>
          })
        }
      </div>
    

    <h2>{movie.title} Movie Ratings</h2>
    <p>At this moment, {movie.title} holds a rating of {movie.vote_average} out of 10, reflecting feedback from {movie.vote_count} viewers. This Cinema continues to be screened in movie theaters, meaning this rating is subject to change as more audience members share their opinions. Overall, it appears to be gaining traction and approval among fans of {movieGenres} ..Genres, indicating its appeal within those categories.</p>

    <h2>Cast Details from Movie</h2>
    <table class="table table-striped table-hover border">
      <thead>
        <tr>
          <th class="w-50">Name</th>
          <th class="w-50">Role</th>
        </tr>
      </thead>
      <tbody>
        {credit.cast.map(p => (
          <tr>
            <td><a class="text-decoration-none" href={"/cast/"+p.id+"/"}>{p.name}</a></td>
            <td>{p.character || "N/A"}</td>
          </tr>

        ))}
      </tbody>
    </table>

    <h2>Crew Details from Movie</h2>
    <table class="table table-striped table-hover border">
      <thead>
        <tr>
          <th class="w-50">Name</th>
          <th class="w-50">Role</th>
        </tr>
      </thead>
      <tbody>
        {credit.crew.map(p => (
          <tr>
            <td><a class="text-decoration-none" href={"/crew/"+p.id+"/"}>{p.name}</a></td>
            <td>{p.job}</td>
          </tr>
        ))}
      </tbody>
    </table>

    <h2>Overall Review</h2>
    <p>{movie.title} is a must-see for fans of {movieGenres}. Directed by {directorNames}, the film is engaging and fun. {hero?.name || "N/A"} and {heroine?.name || "N/A"} gives a strong performance as {hero?.character || "N/A"} and {heroine?.character || "N/A"} respectively, along with impressive roles by {supportChars}, etc...</p>
    <p>The movie features exciting action scenes and explores important themes. The cinematography is striking, and the music enhances the experience.</p>   
    <p>Overall, if you enjoy {movieGenres}, you should definitely watch {movie.title}. It’s entertaining, emotional, and full of surprises.</p>

    <h2>Frequently Asked Questions</h2>
    <FAQ qas={movieFAQs({
      genres: movie.genres.map(genre => genre?.name),
      director: directorNames,
      releaseDate: formatDate(movie?.release_date),
      runtime: movie.runtime+" min",
      title: movie?.title,
      writer: writerNames
    })} />
    
</article>